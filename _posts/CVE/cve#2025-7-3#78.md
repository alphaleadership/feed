 
title: cve fuite du 2025-7-3
date: 2025-7-3
lien: "https://cvefeed.io/vuln/detail/CVE-2025-38166"
categories:
  - cve
---

CVE ID : CVE-2025-38166

Published :  July 3
2025
9:15 a.m. | 2 hours
57 minutes ago

Description : In the Linux kernel
the following vulnerability has been resolved:

bpf: fix ktls panic with sockmap

[ 2172.936997] ------------[ cut here ]------------
[ 2172.936999] kernel BUG at lib/iov_iter.c:629!
......
[ 2172.944996] PKRU: 55555554
[ 2172.945155] Call Trace:
[ 2172.945299]  
[ 2172.945428]  ? die+0x36/0x90
[ 2172.945601]  ? do_trap+0xdd/0x100
[ 2172.945795]  ? iov_iter_revert+0x178/0x180
[ 2172.946031]  ? iov_iter_revert+0x178/0x180
[ 2172.946267]  ? do_error_trap+0x7d/0x110
[ 2172.946499]  ? iov_iter_revert+0x178/0x180
[ 2172.946736]  ? exc_invalid_op+0x50/0x70
[ 2172.946961]  ? iov_iter_revert+0x178/0x180
[ 2172.947197]  ? asm_exc_invalid_op+0x1a/0x20
[ 2172.947446]  ? iov_iter_revert+0x178/0x180
[ 2172.947683]  ? iov_iter_revert+0x5c/0x180
[ 2172.947913]  tls_sw_sendmsg_locked.isra.0+0x794/0x840
[ 2172.948206]  tls_sw_sendmsg+0x52/0x80
[ 2172.948420]  ? inet_sendmsg+0x1f/0x70
[ 2172.948634]  __sys_sendto+0x1cd/0x200
[ 2172.948848]  ? find_held_lock+0x2b/0x80
[ 2172.949072]  ? syscall_trace_enter+0x140/0x270
[ 2172.949330]  ? __lock_release.isra.0+0x5e/0x170
[ 2172.949595]  ? find_held_lock+0x2b/0x80
[ 2172.949817]  ? syscall_trace_enter+0x140/0x270
[ 2172.950211]  ? lockdep_hardirqs_on_prepare+0xda/0x190
[ 2172.950632]  ? ktime_get_coarse_real_ts64+0xc2/0xd0
[ 2172.951036]  __x64_sys_sendto+0x24/0x30
[ 2172.951382]  do_syscall_64+0x90/0x170
......

After calling bpf_exec_tx_verdict()
the size of msg_pl->sg may increase
e.g.
when the BPF program executes bpf_msg_push_data().

If the BPF program sets cork_bytes and sg.size is smaller than cork_bytes
it will return -ENOSPC and attempt to roll back to the non-zero copy
logic. However
during rollback
msg->msg_iter is reset
but since
msg_pl->sg.size has been increased
subsequent executions will exceed the
actual size of msg_iter.
'''
iov_iter_revert(&msg->msg_iter
msg_pl->sg.size - orig_size);
'''

The changes in this commit are based on the following considerations:

1. When cork_bytes is set
rolling back to non-zero copy logic is
pointless and can directly go to zero-copy logic.

2. We can not calculate the correct number of bytes to revert msg_iter.

Assume the original data is "abcdefgh" (8 bytes)
and after 3 pushes
by the BPF program
it becomes 11-byte data: "abc?de?fgh?".
Then
we set cork_bytes to 6
which means the first 6 bytes have been
processed
and the remaining 5 bytes "?fgh?" will be cached until the
length meets the cork_bytes requirement.

However
some data in "?fgh?" is not within 'sg->msg_iter'
(but in msg_pl instead)
especially the data "?" we pushed.

So it doesn't seem as simple as just reverting through an offset of
msg_iter.

3. For non-TLS sockets in tcp_bpf_sendmsg
when a "cork" situation occurs
the user-space send() doesn't return an error
and the returned length is
the same as the input length parameter
even if some data is cached.

Additionally
I saw that the current non-zero-copy logic for handling
corking is written as:
'''
line 1177
else if (ret != -EAGAIN) {
	if (ret == -ENOSPC)
		ret = 0;
	goto send_end;
'''

So it's ok to just return 'copied' without error when a "cork" situation
occurs.

Severity: 0.0 | NA

Visit the link for more details
such as CVSS details
affected products
timeline
and more...


Autres fuites ce jour :
- [https://cvefeed.io/vuln/detail/CVE-2025-5322](https://cvefeed.io/vuln/detail/CVE-2025-5322)
- [https://cvefeed.io/vuln/detail/CVE-2025-49005](https://cvefeed.io/vuln/detail/CVE-2025-49005)
- [https://cvefeed.io/vuln/detail/CVE-2025-49826](https://cvefeed.io/vuln/detail/CVE-2025-49826)
- [https://cvefeed.io/vuln/detail/CVE-2025-53367](https://cvefeed.io/vuln/detail/CVE-2025-53367)
- [https://cvefeed.io/vuln/detail/CVE-2025-53370](https://cvefeed.io/vuln/detail/CVE-2025-53370)
- [https://cvefeed.io/vuln/detail/CVE-2025-53368](https://cvefeed.io/vuln/detail/CVE-2025-53368)
- [https://cvefeed.io/vuln/detail/CVE-2025-53369](https://cvefeed.io/vuln/detail/CVE-2025-53369)
- [https://cvefeed.io/vuln/detail/CVE-2025-34061](https://cvefeed.io/vuln/detail/CVE-2025-34061)
- [https://cvefeed.io/vuln/detail/CVE-2025-34082](https://cvefeed.io/vuln/detail/CVE-2025-34082)
- [https://cvefeed.io/vuln/detail/CVE-2025-34086](https://cvefeed.io/vuln/detail/CVE-2025-34086)
- [https://cvefeed.io/vuln/detail/CVE-2025-34087](https://cvefeed.io/vuln/detail/CVE-2025-34087)
- [https://cvefeed.io/vuln/detail/CVE-2025-34088](https://cvefeed.io/vuln/detail/CVE-2025-34088)
- [https://cvefeed.io/vuln/detail/CVE-2025-34089](https://cvefeed.io/vuln/detail/CVE-2025-34089)
- [https://cvefeed.io/vuln/detail/CVE-2025-52554](https://cvefeed.io/vuln/detail/CVE-2025-52554)
- [https://cvefeed.io/vuln/detail/CVE-2025-23968](https://cvefeed.io/vuln/detail/CVE-2025-23968)
- [https://cvefeed.io/vuln/detail/CVE-2025-45809](https://cvefeed.io/vuln/detail/CVE-2025-45809)
- [https://cvefeed.io/vuln/detail/CVE-2025-53489](https://cvefeed.io/vuln/detail/CVE-2025-53489)
- [https://cvefeed.io/vuln/detail/CVE-2025-53500](https://cvefeed.io/vuln/detail/CVE-2025-53500)
- [https://cvefeed.io/vuln/detail/CVE-2025-53501](https://cvefeed.io/vuln/detail/CVE-2025-53501)
- [https://cvefeed.io/vuln/detail/CVE-2025-53502](https://cvefeed.io/vuln/detail/CVE-2025-53502)
- [https://cvefeed.io/vuln/detail/CVE-2025-6071](https://cvefeed.io/vuln/detail/CVE-2025-6071)
- [https://cvefeed.io/vuln/detail/CVE-2025-6072](https://cvefeed.io/vuln/detail/CVE-2025-6072)
- [https://cvefeed.io/vuln/detail/CVE-2025-6073](https://cvefeed.io/vuln/detail/CVE-2025-6073)
- [https://cvefeed.io/vuln/detail/CVE-2025-6074](https://cvefeed.io/vuln/detail/CVE-2025-6074)
- [https://cvefeed.io/vuln/detail/CVE-2025-6926](https://cvefeed.io/vuln/detail/CVE-2025-6926)
- [https://cvefeed.io/vuln/detail/CVE-2025-49846](https://cvefeed.io/vuln/detail/CVE-2025-49846)
- [https://cvefeed.io/vuln/detail/CVE-2025-48939](https://cvefeed.io/vuln/detail/CVE-2025-48939)
- [https://cvefeed.io/vuln/detail/CVE-2025-53490](https://cvefeed.io/vuln/detail/CVE-2025-53490)
- [https://cvefeed.io/vuln/detail/CVE-2025-45938](https://cvefeed.io/vuln/detail/CVE-2025-45938)
- [https://cvefeed.io/vuln/detail/CVE-2025-43713](https://cvefeed.io/vuln/detail/CVE-2025-43713)
- [https://cvefeed.io/vuln/detail/CVE-2025-50258](https://cvefeed.io/vuln/detail/CVE-2025-50258)
- [https://cvefeed.io/vuln/detail/CVE-2025-50260](https://cvefeed.io/vuln/detail/CVE-2025-50260)
- [https://cvefeed.io/vuln/detail/CVE-2025-50262](https://cvefeed.io/vuln/detail/CVE-2025-50262)
- [https://cvefeed.io/vuln/detail/CVE-2025-50263](https://cvefeed.io/vuln/detail/CVE-2025-50263)
- [https://cvefeed.io/vuln/detail/CVE-2025-5961](https://cvefeed.io/vuln/detail/CVE-2025-5961)
- [https://cvefeed.io/vuln/detail/CVE-2025-3702](https://cvefeed.io/vuln/detail/CVE-2025-3702)
- [https://cvefeed.io/vuln/detail/CVE-2025-49032](https://cvefeed.io/vuln/detail/CVE-2025-49032)
- [https://cvefeed.io/vuln/detail/CVE-2025-49595](https://cvefeed.io/vuln/detail/CVE-2025-49595)
- [https://cvefeed.io/vuln/detail/CVE-2025-49618](https://cvefeed.io/vuln/detail/CVE-2025-49618)
- [https://cvefeed.io/vuln/detail/CVE-2025-2537](https://cvefeed.io/vuln/detail/CVE-2025-2537)
- [https://cvefeed.io/vuln/detail/CVE-2025-2932](https://cvefeed.io/vuln/detail/CVE-2025-2932)
- [https://cvefeed.io/vuln/detail/CVE-2025-27454](https://cvefeed.io/vuln/detail/CVE-2025-27454)
- [https://cvefeed.io/vuln/detail/CVE-2025-27455](https://cvefeed.io/vuln/detail/CVE-2025-27455)
- [https://cvefeed.io/vuln/detail/CVE-2025-27456](https://cvefeed.io/vuln/detail/CVE-2025-27456)
- [https://cvefeed.io/vuln/detail/CVE-2025-27457](https://cvefeed.io/vuln/detail/CVE-2025-27457)
- [https://cvefeed.io/vuln/detail/CVE-2025-27458](https://cvefeed.io/vuln/detail/CVE-2025-27458)
- [https://cvefeed.io/vuln/detail/CVE-2025-27459](https://cvefeed.io/vuln/detail/CVE-2025-27459)
- [https://cvefeed.io/vuln/detail/CVE-2025-27460](https://cvefeed.io/vuln/detail/CVE-2025-27460)
- [https://cvefeed.io/vuln/detail/CVE-2025-27461](https://cvefeed.io/vuln/detail/CVE-2025-27461)
- [https://cvefeed.io/vuln/detail/CVE-2025-2540](https://cvefeed.io/vuln/detail/CVE-2025-2540)
- [https://cvefeed.io/vuln/detail/CVE-2025-40722](https://cvefeed.io/vuln/detail/CVE-2025-40722)
- [https://cvefeed.io/vuln/detail/CVE-2025-40723](https://cvefeed.io/vuln/detail/CVE-2025-40723)
- [https://cvefeed.io/vuln/detail/CVE-2025-6563](https://cvefeed.io/vuln/detail/CVE-2025-6563)
- [https://cvefeed.io/vuln/detail/CVE-2025-27447](https://cvefeed.io/vuln/detail/CVE-2025-27447)
- [https://cvefeed.io/vuln/detail/CVE-2025-27448](https://cvefeed.io/vuln/detail/CVE-2025-27448)
- [https://cvefeed.io/vuln/detail/CVE-2025-27449](https://cvefeed.io/vuln/detail/CVE-2025-27449)
- [https://cvefeed.io/vuln/detail/CVE-2025-27450](https://cvefeed.io/vuln/detail/CVE-2025-27450)
- [https://cvefeed.io/vuln/detail/CVE-2025-27451](https://cvefeed.io/vuln/detail/CVE-2025-27451)
- [https://cvefeed.io/vuln/detail/CVE-2025-27452](https://cvefeed.io/vuln/detail/CVE-2025-27452)
- [https://cvefeed.io/vuln/detail/CVE-2025-27453](https://cvefeed.io/vuln/detail/CVE-2025-27453)
- [https://cvefeed.io/vuln/detail/CVE-2024-5647](https://cvefeed.io/vuln/detail/CVE-2024-5647)
- [https://cvefeed.io/vuln/detail/CVE-2025-0885](https://cvefeed.io/vuln/detail/CVE-2025-0885)
- [https://cvefeed.io/vuln/detail/CVE-2025-6587](https://cvefeed.io/vuln/detail/CVE-2025-6587)
- [https://cvefeed.io/vuln/detail/CVE-2025-38151](https://cvefeed.io/vuln/detail/CVE-2025-38151)
- [https://cvefeed.io/vuln/detail/CVE-2025-38153](https://cvefeed.io/vuln/detail/CVE-2025-38153)
- [https://cvefeed.io/vuln/detail/CVE-2025-38154](https://cvefeed.io/vuln/detail/CVE-2025-38154)
- [https://cvefeed.io/vuln/detail/CVE-2025-38155](https://cvefeed.io/vuln/detail/CVE-2025-38155)
- [https://cvefeed.io/vuln/detail/CVE-2025-38156](https://cvefeed.io/vuln/detail/CVE-2025-38156)
- [https://cvefeed.io/vuln/detail/CVE-2025-38157](https://cvefeed.io/vuln/detail/CVE-2025-38157)
- [https://cvefeed.io/vuln/detail/CVE-2025-38158](https://cvefeed.io/vuln/detail/CVE-2025-38158)
- [https://cvefeed.io/vuln/detail/CVE-2025-38159](https://cvefeed.io/vuln/detail/CVE-2025-38159)
- [https://cvefeed.io/vuln/detail/CVE-2025-38160](https://cvefeed.io/vuln/detail/CVE-2025-38160)
- [https://cvefeed.io/vuln/detail/CVE-2025-38161](https://cvefeed.io/vuln/detail/CVE-2025-38161)
- [https://cvefeed.io/vuln/detail/CVE-2025-38162](https://cvefeed.io/vuln/detail/CVE-2025-38162)
- [https://cvefeed.io/vuln/detail/CVE-2025-38163](https://cvefeed.io/vuln/detail/CVE-2025-38163)
- [https://cvefeed.io/vuln/detail/CVE-2025-38164](https://cvefeed.io/vuln/detail/CVE-2025-38164)
- [https://cvefeed.io/vuln/detail/CVE-2025-38165](https://cvefeed.io/vuln/detail/CVE-2025-38165)
- [https://cvefeed.io/vuln/detail/CVE-2025-38167](https://cvefeed.io/vuln/detail/CVE-2025-38167)
- [https://cvefeed.io/vuln/detail/CVE-2025-38168](https://cvefeed.io/vuln/detail/CVE-2025-38168)
- [https://cvefeed.io/vuln/detail/CVE-2025-38169](https://cvefeed.io/vuln/detail/CVE-2025-38169)
- [https://cvefeed.io/vuln/detail/CVE-2025-38170](https://cvefeed.io/vuln/detail/CVE-2025-38170)
- [https://cvefeed.io/vuln/detail/CVE-2025-38171](https://cvefeed.io/vuln/detail/CVE-2025-38171)
- [https://cvefeed.io/vuln/detail/CVE-2025-38172](https://cvefeed.io/vuln/detail/CVE-2025-38172)
- [https://cvefeed.io/vuln/detail/CVE-2025-38173](https://cvefeed.io/vuln/detail/CVE-2025-38173)
- [https://cvefeed.io/vuln/detail/CVE-2025-38148](https://cvefeed.io/vuln/detail/CVE-2025-38148)
- [https://cvefeed.io/vuln/detail/CVE-2025-38149](https://cvefeed.io/vuln/detail/CVE-2025-38149)
- [https://cvefeed.io/vuln/detail/CVE-2025-38150](https://cvefeed.io/vuln/detail/CVE-2025-38150)
- [https://cvefeed.io/vuln/detail/CVE-2024-9017](https://cvefeed.io/vuln/detail/CVE-2024-9017)
- [https://cvefeed.io/vuln/detail/CVE-2025-5944](https://cvefeed.io/vuln/detail/CVE-2025-5944)
